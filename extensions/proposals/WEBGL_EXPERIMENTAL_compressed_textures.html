<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
        "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>WebGL WEBGL_EXPERIMENTAL_compressed_textures Extension Draft Specification</title>
        <link rel="stylesheet" type="text/css" href="../../resources/webgl-extension.css" />
    <link rel="stylesheet" type="text/css" href="../../resources/default.css" />
    <script src="../../resources/jquery-1.3.2.min.js" type="text/javascript"></script>
</head>
    <!--begin-logo-->
    <div>
      <a href="http://webgl.org/"><img alt=WebGL height=72 src="../../resources/WebGL-Logo.png" width=156></a>
      <div class=right>
  <a href="http://khronos.org/"><img alt=Khronos height=60 src="../../resources/KhronosGroup-3D.png" width=220></a>
      </div>
    </div>
    <!--end-logo-->

    <h1>WebGL WEBGL_EXPERIMENTAL_compressed_textures Extension Draft Specification</h1>

    <h2 class="no-toc">Name</h2>
    <p> WEBGL_EXPERIMENTAL_compressed_textures </p>

    <h2 class="no-toc">Contact</h2>
    <p> <a href="https://www.khronos.org/webgl/public-mailing-list/">WebGL working group</a> (public_webgl 'at' khronos.org) </p>

    <h2 class="no-toc">Contributors</h2>
    <p> Members of the WebGL working group </p>

    <h2 class="no-toc">Version</h2>
    <p> Last modified date: October 25, 2011
    </p>

    <h2 class="no-toc">Dependencies</h2>
    <p> Written against the WebGL API 1.0 specification. </p>

    <h2 class="no-toc">Overview</h2>
    <p>
      This extension exposes compressed texture functionality to WebGL.
    </p>
    <h2 class="no-toc">IDL</h2>
    <p>
<pre class="idl">
module webgl {

interface WEBGL_EXPERIMENTAL_compressed_textures {
    /* Compressed Texture Formats */
    const GLenum COMPRESSED_RGB_S3TC_DXT1_EXT        = 0x83F0;
    const GLenum COMPRESSED_RGBA_S3TC_DXT1_EXT       = 0x83F1;
    const GLenum COMPRESSED_RGBA_S3TC_DXT3_EXT       = 0x83F2;
    const GLenum COMPRESSED_RGBA_S3TC_DXT5_EXT       = 0x83F3;
    const GLenum ETC1_RGB8_OES                       = 0x8D64;
    const GLenum COMPRESSED_RGB_PVRTC_4BPPV1_IMG     = 0x8C00;
    const GLenum COMPRESSED_RGB_PVRTC_2BPPV1_IMG     = 0x8C01;
    const GLenum COMPRESSED_RGBA_PVRTC_4BPPV1_IMG    = 0x8C02;
    const GLenum COMPRESSED_RGBA_PVRTC_2BPPV1_IMG    = 0x8C03;

    void compressedTexImage2D(GLenum target, GLint level,
                              GLenum internalformat, GLsizei width,
                              GLsizei height, GLint border,
                              ArrayBufferView data);
    void compressedTexSubImage2D(GLenum target, GLint level, GLint xoffset,
                                 GLint yoffset, GLsizei width, GLsizei height,
                                 GLenum format, ArrayBufferView data);
};
</pre>
    <h2 class="no-toc">Description</h2>
    <p>
    This extension exposes the standard OpenGL ES 2.0 compressed texture
    extry points, <code>compressedTexImage2D</code> and
    <code>compressedTexSubImage2D</code>.
    </p>
    <p>
    Once this extensions is enabled by calling <code>getExtension</code> then
    the WebGLRenderingContext method <code>getParameter(gl.COMPRESSED_TEXTURE_FORMATS)</code>
    starts returning an array of GLenums indicating the formats support by the
    underlying hardware that are also on the list of
    <a href="#SUPPORTEDFORMATS">supported formats</a>.
    </p>
    <p>
    For applications the recommended usage is to first call <code>getParameter(gl.COMPRESSED_TEXTURE_FORMATS)</code>
    to find out the formats that are supported and then use that information to
    download or generate compressed image data of the correct format or fallback to uncompressed
    formats.
    </p>
<div class="note">
    <p>
    Many OpenGL drivers do not return a correct list of supported formats when
    calling <code>glGetIntegerv(GL_COMPRESSED_TEXTURE_FORMATS)</code>. It is
    recommended that WebGL implementations use other means, for example
    <code>glGetString(GL_EXTENSIONS)</code> to generate a correct list.
    </p>
</div>

    <h3>Methods</h3>

    <dt class="idl-code"><a name="COMPRESSEDTEXIMAGE2D">void compressedTexImage2D</a>(GLenum target, GLint level, GLenum internalformat,
                GLsizei width, GLsizei height, GLint border, ArrayBufferView data)
        <span class="gl-spec">(<a href="http://www.khronos.org/registry/gles/specs/2.0/es_full_spec_2.0.24.pdf#nameddest=section-3.7.1">OpenGL ES 2.0 &sect;3.7.3</a>, <a class="nonnormative" href="http://www.khronos.org/opengles/sdk/2.0/docs/man/xhtml/glCompressedTexImage2D.xml">man page</a>)</span>
    </dt>
    <dd>
        If <code>data</code> is null, an error <code>INVALID_VALUE</code> is generated<br><br>

        If the length of <code>data</code> does not exactly match the size requirements for the given format INVALID_OPERATION error is generated.
        See <a href="#FORMATRESTRICTIONS">Formats Restictions</a>
        <br><br>

        If an attempt is made to call this function with no WebGLTexture bound (see above), an
        <code>INVALID_OPERATION</code> error is generated. <br><br>

        If <code>internalformat</code> is not one of the formats returned by
        <code>gl.getParameter(gl.COMPRESSED_TEXTURE_FORMATS)</code> an
        <code>INVALID_ENUM</code> error is generated.<br><br>

        Other parameters have specific restrictions depending on the format.
        See <a href="#FORMATRESTRICTIONS">Formats Restictions</a>
    </dd>
    <br>
    <dt class="idl-code"><a name="COMPRESSEDTEXSUBIMAGE2D">void compressedTexSubImage2D</a>(GLenum target, GLint level,
                GLint xoffset, GLint yoffset, GLsizei width, GLsizei height, GLenum internalformat, ArrayBufferView data)
        <span class="gl-spec">(<a href="http://www.khronos.org/registry/gles/specs/2.0/es_full_spec_2.0.24.pdf#nameddest=section-3.7.1">OpenGL ES 2.0 &sect;3.7.3</a>, <a class="nonnormative" href="http://www.khronos.org/opengles/sdk/2.0/docs/man/xhtml/glCompressedTexSubImage2D.xml">man page</a>)</span>
    </dt>
    <dd>
        If <code>data</code> is null, an error <code>INVALID_VALUE</code> is generated<br><br>

        If the length of <code>data</code> does not exactly match the size requirements for the given format INVALID_VALUE error is generated.
        See <a href="#FORMATRESTRICTIONS">Formats Restictions</a>
        <br><br>

        If an attempt is made to call this function with no WebGLTexture bound (see above), an
        <code>INVALID_OPERATION</code> error is generated. <br><br>

        If <code>format</code> does not is not one of the formats returned by
        <code>gl.getParameter(gl.COMPRESSED_TEXTURE_FORMATS)</code> an
        <code>INVALID_ENUM</code> error is generated.<br><br>

        If <code>format</code> does not match the <code>internalformat</code> specifed by
        a previous call to <code>compressedTexImage2D</code> an <code>INVALID_OPERATION</code>
        error is generated.<br><br>

        Other parameters have specific restrictions depending on the format.
        See <a href="#FORMATRESTRICTIONS">Formats Restictions</a>
    </dd>

    <h3><a name="SUPPORTEDFORMATS"></a>Supported Formats</h3>
    <p>Only the following formats are allowed:</p>
    <ul>
    <li><code>COMPRESSED_RGB_S3TC_DXT1_EXT</code>
    <li><code>COMPRESSED_RGBA_S3TC_DXT1_EXT</code>
    <li><code>COMPRESSED_RGBA_S3TC_DXT3_EXT</code>
    <li><code>COMPRESSED_RGBA_S3TC_DXT5_EXT</code>
    <li><code>ETC1_RGB8_OES</code>
    <li><code>COMPRESSED_RGB_PVRTC_4BPPV1_IMG</code>
    <li><code>COMPRESSED_RGB_PVRTC_2BPPV1_IMG</code>
    <li><code>COMPRESSED_RGBA_PVRTC_4BPPV1_IMG</code>
    <li><code>COMPRESSED_RGBA_PVRTC_2BPPV1_IMG</code>
    </ul>

    <h3><a name="FORMATRESTRICTIONS"></a>Format Restrictions</h3>
    <dt>COMPRESSED_RGB_S3TC_DXT1_EXT</dt>
    <dt>COMPRESSED_RGBA_S3TC_DXT1_EXT</dt>
    <dt>ETC1_RGB8_OES</dt>
    <dd><p>The size of the ArrayBufferView, <code>pixels</code>, passed to either
    <code>compressedTexImage2D</code> or <code>compressedTexSubImage2D</code>
    must match the following equation:</p>
    <blockquote><code>
    floor((width + 3) / 4) * (floor(height + 3) / 4) * 16
    </code></blockquote>
    <p>
    If it is not an error <code>INVALID_OPERATION</code> is generated.<br><br>

    For <code>compressedTexSubImage2D</code> <code>xoffset</code> and
	<code>yoffset</code> must be a multiple of 4 and
	<code>width</code> and
	<code>height</code> must be less than 4 or a multple of 4.
    If they are not an error <code>INVALID_VALUE</code> is generated.
    </p>
    </dd>

    <dt>COMPRESSED_RGBA_S3TC_DXT3_EXT</dt>
    <dt>COMPRESSED_RGBA_S3TC_DXT5_EXT</dt>
    <dd><p>The size of the ArrayBufferView, <code>pixels</code>, passed to either
    <code>compressedTexImage2D</code> or <code>compressedTexSubImage2D</code>
    must match the following equation:</p>
    <blockquote><code>
    floor((width + 3) / 4) * (floor(height + 3) / 4) * 32
    </code></blockquote>
    <p>
    If it is not an <code>INVALID_OPERATION</code> error is generated.<br><br>

    For <code>compressedTexSubImage2D</code> <code>xoffset</code> and
	<code>yoffset</code> must be a multiple of 4 and <code>width</code> and
	<code>height</code> must be less than 4 or a multple of 4.
    If they not an <code>INVALID_VALUE</code> error is generated.
    </p>
    </dd>

    <dt>COMPRESSED_RGB_PVRTC_4BPPV1_IMG</dt>
    <dt>COMPRESSED_RGBA_PVRTC_4BPPV1_IMG</dt>
    <dd><p>The size of the ArrayBufferView, <code>pixels</code>, passed to either
    <code>compressedTexImage2D</code> or <code>compressedTexSubImage2D</code>
    must match the following equation:</p>
    <blockquote><code>
    floor(max(width, 8) * max(height, 8) * 4 + 7) / 8)
    </code></blockquote>
    <p>
    If it is not an <code>INVALID_OPERATION</code> error is generated.<br><br>

    For <code>compressedTexSubImage2D</code> <code>width</code> and
    <code>height</code> must match the width and height of the original texture and
    <code>xoffset</code>, and <code>yoffset</code> must 0.
    If they not an <code>INVALID_VALUE</code> error is generated.
    </p>
    </dd>

    <dt>COMPRESSED_RGB_PVRTC_2BPPV1_IMG</dt>
    <dt>COMPRESSED_RGBA_PVRTC_2BPPV1_IMG</dt>
    <dd><p>The size of the ArrayBufferView, <code>pixels</code>, passed to either
    <code>compressedTexImage2D</code> or <code>compressedTexSubImage2D</code>
    must match the following equation:</p>
    <blockquote><code>
    floor((max(width, 16) * max(height, 8) * 2 + 7) / 8)
    </code></blockquote>
    <p>
    If it is not an <code>INVALID_OPERATION</code> error is generated.<br><br>

    For <code>compressedTexSubImage2D</code> <code>width</code> and
    <code>height</code> must match the width and height of the original texture and
    <code>xoffset</code> and <code>yoffset</code> must 0.
    If they not an <code>INVALID_VALUE</code> error is generated.
    </p>
    </dd>
<div class="note">
    <p>
    It is recommended the WebGL implementation enforce all of these restrictions and not
    rely on the underlying OpenGL driver to do so.
    </p>
</div>

    <h2 class="no-toc">Notes</h2>
    <p>the pixelStorei settings <code>UNPACK_ALIGNMENT</code>,
    <code>UNPACK_PREMULTIPLY_ALPHA_WEBGL</code>,
    <code>UNPACK_FLIP_Y_WEBGL</code> and
    <code>UNPACK_COLORSPACE_CONVERSION_WEBGL</code> have no effect on either
    <code>compressedTexImage2D</code> or <code>compressedTexSubImage2D</code>.
    <h2 class="no-toc">Issues</h2>
    <p class="issue">
    Should compressedTexSubImage2D be exposed?
    </p>
	<p>I don't know if any apps use it and it's possible some OpenGL drivers
	have different restrictions than others. If it's not used maybe it should
	be removed.</p>
	<p class="issue">
	Which formats should supported?
	</p>
	<p>
	Should ATITC be added? I originally had them in there but my 1 minute search
	of the format so I could write the restrictions didn't come up with any docs
	so I left them out for now.
	</p>
	<p>3DC in? 2bit PVRTC out? DXT3 out?</p>
    <h2 class="no-toc">Revision History</h2>
    <p>
      <ul>
      <li> 2011/10/25 Initial draft.</li>
      <li> 2011/10/26 Fixed DXT width and height restrictions.</li>
      <li> 2011/10/26 Fixed typos.</li>
      </ul>
    </p>
</body>
</html>
