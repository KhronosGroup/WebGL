EXTS := OES_standard_derivatives \
	OES_texture_float \
	OES_texture_half_float \
	OES_vertex_array_object \
	WEBGL_lose_context \
	WEBGL_debug_renderer_info \
	WEBGL_debug_shaders \
	WEBGL_compressed_texture_s3tc \
	OES_depth_texture \
	proposals/WEBGL_shared_resources \
	OES_element_index_uint \
	EXT_texture_filter_anisotropic \
	proposals/ANGLE_instanced_arrays \
	proposals/WEBGL_fbo_color_attachments \

EXT_XMLS := $(addsuffix /extension.xml,$(EXTS))
EXT_IDXS := $(addsuffix /index.html,$(EXTS))

comma:=,
empty:=
space:=$(empty) $(empty)
EXT_LIST:=$(subst $(space),$(comma),$(EXTS))

.PHONY: all clean

all: index.html index.atom $(EXT_IDXS) template/index.html

index.html: registry.xml registry.xsl registry.html rev_utils.xsl
	@echo "<!-- AUTOGENERATED FILE - DO NOT EDIT - SEE Makefile -->" > index.html
	xsltproc --stringparam basepath `echo $*/base | sed -e "s/[^\/]*/../g"` --html registry.xsl registry.html >> index.html

index.atom: registry.xml revisions.atom atom.xsl
	xsltproc atom.xsl revisions.atom > index.atom

registry.xml: $(EXT_XMLS) summary.xsl summary.xml
	xsltproc --stringparam extensions $(EXT_LIST) \
		summary.xsl summary.xml > registry.xml

%/index.html: %/extension.xml extension.xsl rev_utils.xsl
	xsltproc --stringparam basepath `echo $*/base | sed -e "s/[^\/]*/../g"` extension.xsl $*/extension.xml > $*/index.html

clean:
	rm -f index.html index.atom registry.xml
	rm -f $(EXT_IDXS) template/index.html
